<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

    <head th:replace="admin/fragments/head :: head">
        <title>Quản lý Sản phẩm - Thương mại Điện tử</title>
    </head>

    <body>
        <div class="d-flex wrapper">
            <!-- Sidebar -->
            <div th:replace="admin/fragments/sidebar :: sidebar" class="sidebar-container"></div>

            <div class="flex-grow-1 main-content">
                <!-- Navbar -->
                <nav th:replace="admin/fragments/navbar :: navbar"></nav>

                <!-- Content here -->
                <div class="p-1 min-vh-100 content">

                    <div class="container-fluid">
                        <div class="mb-4 row">
                            <div class="d-flex justify-content-between align-items-center col-12">
                                <h1 class="h3">Danh sách Sản phẩm</h1>
                                <a href="/admin/products/add" class="btn btn-primary">
                                    <i class="fa-plus fas"></i> Thêm Sản phẩm Mới
                                </a>
                            </div>
                        </div>

                        <!-- Bộ lọc -->
                        <div class="mb-4 card">
                        <div class="card-body">
                            <form th:action="@{/admin/products}" method="get" class="row">
                                <div class="col-md-3">
                                    <input type="text" name="search" class="form-control"
                                        placeholder="Tìm kiếm sản phẩm" th:value="${param.search}">
                                </div>
                                <div class="col-md-3">
                                    <select name="category" class="form-control">
                                        <option value="">Tất cả Danh mục</option>
                                        <option th:each="category : ${categories}" th:value="${category.id}"
                                            th:text="${category.categoryName}" th:selected="${param.category == category.id}">
                                            Danh mục
                                        </option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <select name="status" class="form-control">
                                        <option value="">Trạng thái</option>
                                        <option value="ACTIVE" th:selected="${param.status == 'ACTIVE'}">Đang bán
                                        </option>
                                        <option value="INACTIVE" th:selected="${param.status == 'INACTIVE'}">Ngừng bán
                                        </option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-secondary">
                                        <i class="fa-filter fas"></i> Lọc
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                        <!-- Bảng Sản phẩm -->
                        <div class="card">
                            <!-- <div th:each="product : ${products}">
                            <h1 th:text="${product.category.categoryName}"></h1>
                        </div> -->
                            <div class="table-responsive">
                                <table class="table table-hover table-striped">
                                    <thead class="thead-light">
                                        <tr>
                                            <th>
                                                <input type="checkbox" id="selectAll">
                                            </th>
                                            <th>Mã SP</th>
                                            <th>Hình ảnh</th>
                                            <th>Tên Sản phẩm</th>
                                            <th>Danh mục</th>
                                            <th>Giá</th>
                                            <th>Tồn kho</th>
                                            <th>Trạng thái</th>
                                            <th>Hành động</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="product : ${products}">
                                            <td>
                                                <input type="checkbox" th:value="${product.id}">
                                            </td>
                                            <td th:text="${product.id}">SP001</td>
                                            <td>
                                                <img th:src="${product.imageUrl}" class="img-thumbnail"
                                                    style="max-width: 80px;" alt="Ảnh sản phẩm">
                                            </td>
                                            <td th:text="${product.productName}">Tên Sản phẩm</td>
                                            <td th:text="${product.category.categoryName}">Danh mục</td>
                                            <!-- <td th:text="${#numbers.formatCurrency(product.price)}">100,000 VND</td>-->
                                            <td th:text="${'$' + product.price}">100,000 VND</td>
                                            <td th:text="${product.stockQuantity}">50</td>
                                            <td>
                                                <span
                                                    th:class="${product.stockQuantity > 0 ? 'badge bg-success' : 'badge bg-danger'}"
                                                    th:text="${product.stockQuantity > 0 ? 'Đang bán' : 'Ngừng bán'}">
                                                    Trạng thái
                                                </span>
                                            </td>
                                            <td>
                                                <button type="button" class="btn btn-primary"><a class="dropdown-item" th:href="@{/admin/products/edit/{id}(id=${product.id})}">
                                                    <i class="fa-edit fas"></i> Chỉnh sửa
                                                </a></button>
                                                <button type="button" class="text-white btn btn-danger"><a class="text-white dropdown-item" href="#" th:data-id="${product.id}" onclick="confirmDelete(this)">
                                                    <i class="fa-trash fas"></i> Xóa
                                                </a></button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Phân trang -->
                            <div class="d-flex justify-content-between align-items-center card-footer">
                                <div th:replace="admin/fragments/pagination :: pagination"></div>
                                <div class="text-muted">
                                    Hiển thị
                                    <span th:text="${products.number * products.size + 1}"></span>
                                    -
                                    <span
                                        th:text="${products.number * products.size + products.numberOfElements}"></span>
                                    trong tổng số
                                    <span th:text="${products.totalElements}"></span> sản phẩm
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Xác nhận Xóa -->
            <div class="fade modal" id="deleteModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Xác nhận Xóa</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            Bạn có chắc chắn muốn xóa sản phẩm này không?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                            <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Xóa</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vendor Scripts -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" defer></script>

            <!-- Script xử lý -->
            <script th:inline="javascript" defer>
                document.addEventListener("DOMContentLoaded", function () {
                    const dropdownButton = document.querySelector('.dropdown-toggle');
                    const dropdown = new bootstrap.Dropdown(dropdownButton);
                    dropdownButton.addEventListener('click', function () {
                        dropdown.toggle(); // Kích hoạt dropdown khi click
                    });
                });


                const dropdownToggle = document.querySelectorAll('.dropdown-toggle');
                dropdownToggle.forEach((toggle) => {
                    toggle.addEventListener('mouseenter', function () {
                        const dropdown = new bootstrap.Dropdown(toggle);
                        dropdown.show();
                    });
                    toggle.addEventListener('mouseleave', function () {
                        const dropdown = new bootstrap.Dropdown(toggle);
                        dropdown.hide();
                    });
                });

            </script>

            <!-- Script xử lý -->
            <script th:inline="javascript" defer>
                function confirmDelete(element) {
                    const productId = element.getAttribute('data-id');
                    const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
                    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');

                    confirmDeleteBtn.onclick = function () {
                        window.location.href = `/admin/products/delete/${productId}`;
                    };

                    deleteModal.show();
                }

                // Chọn tất cả checkbox
                document.getElementById('selectAll').addEventListener('change', function (e) {
                    const checkboxes = document.querySelectorAll('tbody input[type="checkbox"]');
                    checkboxes.forEach(checkbox => {
                        checkbox.checked = e.target.checked;
                    });
                });
            </script>
    </body>

</html>